<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Mass Contact Maker - Functionality Test</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; }
        .test-result { margin: 10px 0; padding: 10px; border-radius: 5px; }
        .pass { background-color: #d4edda; color: #155724; }
        .fail { background-color: #f8d7da; color: #721c24; }
        .test-section { margin: 20px 0; border: 1px solid #ddd; padding: 15px; }
    </style>
</head>
<body>
    <h1>Mass Contact Maker - Functionality Test</h1>
    
    <div class="test-section">
        <h2>1. DOM Elements Test</h2>
        <div id="dom-test-results"></div>
    </div>
    
    <div class="test-section">
        <h2>2. Phone Validation Test</h2>
        <div id="phone-test-results"></div>
    </div>
    
    <div class="test-section">
        <h2>3. CSV Parsing Test</h2>
        <div id="csv-test-results"></div>
    </div>
    
    <div class="test-section">
        <h2>4. VCF Generation Test</h2>
        <div id="vcf-test-results"></div>
    </div>
    
    <script src="lib/xlsx.full.min.js"></script>
    <script src="lib/FileSaver.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.10.1/jszip.min.js"></script>
    
    <script>
        // Test phone validation function
        function validatePhoneNumber(number) {
            if (!number) return false;
            try {
                const cleaned = number.toString().replace(/\D/g, "");
                return cleaned.length >= 10 && /^\d+$/.test(cleaned);
            } catch (error) {
                console.error("Phone validation error:", error);
                return false;
            }
        }
        
        function runTests() {
            console.log("Starting comprehensive tests...");
            
            // Test 1: DOM Elements
            const domTestResults = document.getElementById('dom-test-results');
            const requiredElements = [
                'drop-zone',
                'phone-column-selector', 
                'first-name-column-selector',
                'last-name-column-selector',
                'email-column-selector',
                'country-code',
                'group-name',
                'data-preview',
                'total-rows',
                'valid-phones', 
                'preview-list'
            ];
            
            let domPassed = 0;
            requiredElements.forEach(id => {
                const element = document.getElementById(id);
                const result = document.createElement('div');
                result.className = 'test-result ' + (element ? 'pass' : 'fail');
                result.textContent = `Element "${id}": ${element ? 'FOUND' : 'NOT FOUND'}`;
                domTestResults.appendChild(result);
                if (element) domPassed++;
            });
            
            // Test 2: Phone Validation
            const phoneTestResults = document.getElementById('phone-test-results');
            const testPhones = [
                { number: '9876543210', expected: true },
                { number: '+919876543210', expected: true },
                { number: '123456789', expected: false }, // Too short
                { number: 'abc1234567890', expected: true }, // Contains letters but has valid digits
                { number: '', expected: false },
                { number: null, expected: false }
            ];
            
            let phonePassed = 0;
            testPhones.forEach(test => {
                const result = validatePhoneNumber(test.number) === test.expected;
                const div = document.createElement('div');
                div.className = 'test-result ' + (result ? 'pass' : 'fail');
                div.textContent = `Phone "${test.number}": ${result ? 'PASS' : 'FAIL'}`;
                phoneTestResults.appendChild(div);
                if (result) phonePassed++;
            });
            
            // Test 3: CSV Parsing
            const csvTestResults = document.getElementById('csv-test-results');
            const testCSV = 'First Name,Last Name,Phone,Email\\nJohn,Doe,9876543210,john@email.com\\nJane,Smith,8765432109,jane@email.com';
            
            try {
                const lines = testCSV.split('\\n');
                const headers = lines[0].split(',');
                const data = lines.slice(1).map(line => line.split(','));
                
                const csvResult = document.createElement('div');
                csvResult.className = 'test-result pass';
                csvResult.textContent = `CSV parsing: PASS (${headers.length} columns, ${data.length} data rows)`;
                csvTestResults.appendChild(csvResult);
            } catch (error) {
                const csvResult = document.createElement('div');
                csvResult.className = 'test-result fail';
                csvResult.textContent = `CSV parsing: FAIL (${error.message})`;
                csvTestResults.appendChild(csvResult);
            }
            
            // Test 4: VCF Generation
            const vcfTestResults = document.getElementById('vcf-test-results');
            try {
                const testContact = {
                    phone: '9876543210',
                    firstName: 'John',
                    lastName: 'Doe',
                    email: 'john@email.com'
                };
                
                let vcf = "BEGIN:VCARD\\n";
                vcf += "VERSION:3.0\\n";
                vcf += `N:${testContact.lastName};${testContact.firstName};;;\\n`;
                vcf += `FN:${testContact.firstName} ${testContact.lastName}\\n`;
                vcf += `TEL;TYPE=CELL:+91${testContact.phone}\\n`;
                vcf += `EMAIL:${testContact.email}\\n`;
                vcf += "END:VCARD\\n";
                
                const vcfResult = document.createElement('div');
                vcfResult.className = 'test-result pass';
                vcfResult.textContent = 'VCF generation: PASS';
                vcfTestResults.appendChild(vcfResult);
                
                // Show sample VCF
                const sampleDiv = document.createElement('div');
                sampleDiv.innerHTML = `<pre style="background: #f5f5f5; padding: 10px; margin: 10px 0;">${vcf}</pre>`;
                vcfTestResults.appendChild(sampleDiv);
                
            } catch (error) {
                const vcfResult = document.createElement('div');
                vcfResult.className = 'test-result fail';
                vcfResult.textContent = `VCF generation: FAIL (${error.message})`;
                vcfTestResults.appendChild(vcfResult);
            }
            
            // Summary
            const summary = document.createElement('div');
            summary.className = 'test-section';
            summary.innerHTML = `
                <h2>Test Summary</h2>
                <p><strong>DOM Elements:</strong> ${domPassed}/${requiredElements.length} found</p>
                <p><strong>Phone Validation:</strong> ${phonePassed}/${testPhones.length} passed</p>
                <p><strong>Overall Status:</strong> ${domPassed === requiredElements.length && phonePassed === testPhones.length ? '✅ ALL TESTS PASSED' : '❌ SOME TESTS FAILED'}</p>
            `;
            document.body.appendChild(summary);
        }
        
        // Load original page content first
        fetch('index.html')
            .then(response => response.text())
            .then(html => {
                // Extract and append the original page content to test DOM elements
                const parser = new DOMParser();
                const doc = parser.parseFromString(html, 'text/html');
                const originalElements = doc.body.innerHTML;
                
                // Create a hidden container for the original content
                const hiddenDiv = document.createElement('div');
                hiddenDiv.style.display = 'none';
                hiddenDiv.innerHTML = originalElements;
                document.body.appendChild(hiddenDiv);
                
                // Run tests after content is loaded
                setTimeout(runTests, 100);
            })
            .catch(error => {
                console.error('Error loading original page:', error);
                runTests(); // Run tests anyway
            });
    </script>
</body>
</html>
