<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Debug Last Name Issue</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; }
        .test-section { margin: 20px 0; padding: 15px; border: 1px solid #ddd; }
        .result { margin: 10px 0; padding: 10px; border-radius: 5px; }
        .pass { background-color: #d4edda; color: #155724; }
        .fail { background-color: #f8d7da; color: #721c24; }
    </style>
</head>
<body>
    <h1>Last Name Functionality Debug</h1>
    
    <div class="test-section">
        <h2>DOM Elements Test</h2>
        <div id="dom-results"></div>
    </div>
    
    <div class="test-section">
        <h2>CSV Parsing Test</h2>
        <div id="csv-results"></div>
    </div>
    
    <div class="test-section">
        <h2>VCF Generation Test</h2>
        <div id="vcf-results"></div>
    </div>
    
    <script>
        function runDebugTests() {
            // Test 1: Check DOM Elements
            const domResults = document.getElementById('dom-results');
            const elements = [
                'phone-column-selector',
                'first-name-column-selector', 
                'last-name-column-selector',
                'email-column-selector'
            ];
            
            elements.forEach(id => {
                const element = document.getElementById(id);
                const div = document.createElement('div');
                div.className = 'result ' + (element ? 'pass' : 'fail');
                div.textContent = `${id}: ${element ? 'FOUND' : 'NOT FOUND'}`;
                domResults.appendChild(div);
                
                if (element && id === 'last-name-column-selector') {
                    console.log('Last name selector element:', element);
                    console.log('Options count:', element.options.length);
                }
            });
            
            // Test 2: CSV Parsing with Last Names
            const csvResults = document.getElementById('csv-results');
            const testCSV = 'First Name,Last Name,Phone,Email\\nJohn,Doe,9876543210,john@test.com\\nJane,Smith,8765432109,jane@test.com';
            
            try {
                const lines = testCSV.split('\\n');
                const headers = lines[0].split(',');
                const data = lines.slice(1).map(line => line.split(','));
                
                console.log('Headers:', headers);
                console.log('Data:', data);
                
                const result1 = document.createElement('div');
                result1.className = 'result pass';
                result1.textContent = `CSV Headers: ${headers.join(', ')}`;
                csvResults.appendChild(result1);
                
                const result2 = document.createElement('div');
                result2.className = 'result pass';
                result2.textContent = `Sample Data: ${data[0] ? data[0].join(' | ') : 'No data'}`;
                csvResults.appendChild(result2);
                
                // Test last name extraction
                if (data[0]) {
                    const lastName = data[0][1]; // Should be "Doe"
                    const result3 = document.createElement('div');
                    result3.className = 'result ' + (lastName === 'Doe' ? 'pass' : 'fail');
                    result3.textContent = `Last Name Extraction: "${lastName}" (expected "Doe")`;
                    csvResults.appendChild(result3);
                }
                
            } catch (error) {
                const errorDiv = document.createElement('div');
                errorDiv.className = 'result fail';
                errorDiv.textContent = `CSV Error: ${error.message}`;
                csvResults.appendChild(errorDiv);
            }
            
            // Test 3: VCF Generation with Last Names
            const vcfResults = document.getElementById('vcf-results');
            try {
                const testContact = {
                    firstName: 'John',
                    lastName: 'Doe',
                    phone: '9876543210',
                    email: 'john@test.com'
                };
                
                let vcf = "BEGIN:VCARD\\n";
                vcf += "VERSION:3.0\\n";
                vcf += `N:${testContact.lastName};${testContact.firstName};;;\\n`;
                vcf += `FN:${testContact.firstName} ${testContact.lastName}\\n`;
                vcf += `TEL;TYPE=CELL:+91${testContact.phone}\\n`;
                vcf += `EMAIL:${testContact.email}\\n`;
                vcf += "END:VCARD\\n";
                
                const vcfDiv = document.createElement('div');
                vcfDiv.className = 'result pass';
                vcfDiv.innerHTML = `<strong>VCF Generated:</strong><pre>${vcf}</pre>`;
                vcfResults.appendChild(vcfDiv);
                
                // Check if N field is correct
                const nFieldMatch = vcf.match(/N:([^;]*);([^;]*);/);
                if (nFieldMatch) {
                    const [, lastName, firstName] = nFieldMatch;
                    const nFieldDiv = document.createElement('div');
                    nFieldDiv.className = 'result ' + (lastName === 'Doe' && firstName === 'John' ? 'pass' : 'fail');
                    nFieldDiv.textContent = `N Field Check: LastName="${lastName}", FirstName="${firstName}"`;
                    vcfResults.appendChild(nFieldDiv);
                }
                
            } catch (error) {
                const errorDiv = document.createElement('div');
                errorDiv.className = 'result fail';
                errorDiv.textContent = `VCF Error: ${error.message}`;
                vcfResults.appendChild(errorDiv);
            }
        }
        
        // Load main page content to test DOM elements
        fetch('index.html')
            .then(response => response.text())
            .then(html => {
                const parser = new DOMParser();
                const doc = parser.parseFromString(html, 'text/html');
                const originalElements = doc.body.innerHTML;
                
                const hiddenDiv = document.createElement('div');
                hiddenDiv.style.display = 'none';
                hiddenDiv.innerHTML = originalElements;
                document.body.appendChild(hiddenDiv);
                
                setTimeout(runDebugTests, 100);
            })
            .catch(error => {
                console.error('Error loading page:', error);
                runDebugTests();
            });
    </script>
</body>
</html>
